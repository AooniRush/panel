<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth0 Login</title>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/1.19/auth0-spa-js.production.js"></script>
</head>
<body>
    <h1>ようこそ、GitHub Pages!</h1>
    <button id="login">ログイン</button>
    <button id="logout" style="display:none;">ログアウト</button>
    
    <div id="user-info" style="display:none;">
        <h2>ユーザー情報</h2>
        <pre id="user-details"></pre>
    </div>

    <script>
        // Auth0 設定
        const auth0 = await createAuth0Client({
            domain: 'YOUR_AUTH0_DOMAIN',
            client_id: 'YOUR_CLIENT_ID',
            redirect_uri: window.location.href
        });

        const loginButton = document.getElementById('login');
        const logoutButton = document.getElementById('logout');
        const userInfo = document.getElementById('user-info');
        const userDetails = document.getElementById('user-details');

        // ログインボタンのクリック時
        loginButton.addEventListener('click', async () => {
            await auth0.loginWithRedirect();
        });

        // ログアウトボタンのクリック時
        logoutButton.addEventListener('click', async () => {
            await auth0.logout({
                returnTo: window.location.origin
            });
        });

        // ページが読み込まれたときに認証状態を確認
        const isAuthenticated = await auth0.isAuthenticated();

        if (isAuthenticated) {
            const user = await auth0.getUser();
            loginButton.style.display = 'none';
            logoutButton.style.display = 'inline-block';
            userInfo.style.display = 'block';
            userDetails.textContent = JSON.stringify(user, null, 2);
        } else {
            loginButton.style.display = 'inline-block';
            logoutButton.style.display = 'none';
            userInfo.style.display = 'none';
        }

        // リダイレクト後に認証状態をチェック
        if (window.location.search.includes('code=')) {
            await auth0.handleRedirectCallback();
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    </script>
</body>
</html>
